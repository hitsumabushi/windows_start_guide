<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>実践に役立つ雑多な項目 &mdash; Windows Start Guide v0.1 ドキュメント</title>
    
    <link rel="stylesheet" href="../../_static/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'v0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="top" title="Windows Start Guide v0.1 ドキュメント" href="../../index.html" />
    <link rel="next" title="PowerShell DSC 入門" href="10_powershell_dsc.html" />
    <link rel="prev" title="チュートリアル" href="03_powershell_script_intro_tutorial.html" /> 
  </head>
  <body role="document">
<div id="header">
  <div id="globalnavi">
  </div>
  <div id="titledesign">
<link href='http://fonts.googleapis.com/css?family=Bad+Script' rel='stylesheet' type='text/css'>
    <h1><a href="../../index.html">Windows Start Guide</a></h1>
  </div>
</div>





    <div class="document">
 <div id="document">
  <div class="section" id="id1">
<h1>実践に役立つ雑多な項目<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="id2">
<h2>リモート実行<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id3">
<h3>前準備<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">まず、実行マシン、対象マシンの両方で WinRMを有効にする。</div>
<div class="line"><code class="docutils literal"><span class="pre">Enable-PSRemoting</span></code> コマンドレットで有効にできる。</div>
</div>
</div>
<div class="section" id="id4">
<h3>実行<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal"><span class="pre">Invoke-Commad</span></code> というコマンドレットで実行できる。</p>
<div class="code PowerShell highlight-python"><div class="highlight"><pre># Computer01 のプロセスを取得
Invoke-Commad Computer01 { Get-Process }
# 現在のユーザーと異なるユーザーでアクセスする必要がある場合
Invoke-Commad Computer01 -Credential username { Get-Process }
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>セッションの利用<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">毎回、セッション作成・削除が起こると無駄なのでセッション情報を保持する。</div>
<div class="line">セッションを利用すれば、セッション中は変数を共有できるので、そういう意味でもセッションの方が汎用性が高く、便利。</div>
<div class="line">セッション利用時のフローを説明する。</div>
</div>
<div class="code PowerShell highlight-python"><div class="highlight"><pre># セッション作成
$session = New-PSSession -ComputerName Computer01
# セッションを使ってコマンド実行
Invoke-Commad -Session $session { Get-Process }
# もしくは、セッションにEnterする
Enter-PSSession $session
#...
exit
# セッション削除
Remove-PSSession
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2>ワークフロー<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">処理を確実に最後まで実行するための仕組み。</div>
<div class="line"><em>TODO</em></div>
</div>
</div>
<div class="section" id="id7">
<h2>バックグラウンド実行<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><em>TODO</em></p>
</div>
<div class="section" id="ps">
<h2>PSドライブ<a class="headerlink" href="#ps" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">PowerShellから階層構造を持つリソースに、簡単にアクセスするためのもの。</div>
<div class="line">例えば、ファイルシステムや、レジストリ、環境変数、関数、スクリプト変数など。</div>
</div>
<div class="highlight-python"><div class="highlight"><pre># PSドライブの確認
Get-PSDrive

# PSドライブへの移動 と 参照
Set-Location hkcu:
Get-ChildItem
</pre></div>
</div>
<div class="line-block">
<div class="line">注意点として、環境変数を変更するために、envを直接書き換えても、システム全体では反映されない。</div>
<div class="line">Environmentクラスの</div>
</div>
<p><code class="docutils literal"><span class="pre">SetEnvironmentVariable</span></code>メソッドを利用すること。</p>
</div>
<div class="section" id="id8">
<h2>パラメータ<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id9">
<h3>共通パラメータ<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">以下のパラメータは、ヘルプ上でも <code class="docutils literal"><span class="pre">&lt;CommonParameters&gt;</span></code> となっている。</div>
<div class="line"><code class="docutils literal"><span class="pre">Get-Help</span> <span class="pre">about_CommonParameters</span></code> を見ると、さらに詳細がわかる。</div>
</div>
<ul class="simple">
<li>-Verbose<ul>
<li>詳細なログを表示</li>
</ul>
</li>
<li>-Debug<ul>
<li>もっと詳細なログを表示</li>
</ul>
</li>
<li>-WarningAction <em>action</em><ul>
<li>実行時に warning が発生した場合の処理を指定する</li>
<li><em>action</em> の内容<ul>
<li>Continue</li>
<li>Stop</li>
<li>SilentlyContinue</li>
<li>Inquire</li>
<li>Ignore</li>
</ul>
</li>
</ul>
</li>
<li>-ErrorAction <em>action</em><ul>
<li>実行時に error が発生した場合の処理を指定する</li>
<li><em>action</em> の内容は WarningAction と同じ</li>
</ul>
</li>
<li>-WarningVariable <em>variable</em><ul>
<li>指定された文字列変数に、warningを格納する</li>
<li><em>variable</em> の指定方法は、<ul>
<li>variable_name の場合、${variable_name} に格納される</li>
<li>+variable_name の場合、${variable_name} に追加される</li>
</ul>
</li>
</ul>
</li>
<li>-ErrorVariable <em>variable</em><ul>
<li>指定された文字列変数に、errorを格納する</li>
<li><em>variable</em> の指定方法は、WarningVariable と同じ</li>
</ul>
</li>
<li>-OutVariable <em>variable</em><ul>
<li>指定された文字列変数に、出力を格納する</li>
<li><em>variable</em> の指定方法は、WarningVariable と同じ</li>
</ul>
</li>
<li>-OutBuffer<ul>
<li>指定された数+1
のオブジェクトが生成されてから、パイプラインにある次のコマンドレットを実行</li>
</ul>
</li>
<li>-?<ul>
<li>ヘルプを表示</li>
</ul>
</li>
</ul>
<p>リスク管理パラメータと呼ばれる、破壊的な変更を行うコマンドによく使われるパラメータがある。</p>
<ul class="simple">
<li>-WhatIf</li>
<li>-Confirm</li>
</ul>
</div>
<div class="section" id="id10">
<h3>デフォルトパラメータ<a class="headerlink" href="#id10" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">コマンドを実行する際、パラメータを毎回指定するのが面倒な場合などに、パラメータを省略した時のデフォルトをユーザー側で定義できる。</div>
<div class="line"><code class="docutils literal"><span class="pre">$PSDefaultParamaterValues</span></code> 変数に、連想配列として定義していく。</div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;#
  $psdefaultparamatervalues = @{&quot;_コマンドレット名_:_パラメータ名_&quot;=_デフォルトパラメータ_}
  コマンドレット名や、パラメータ名には、ワイルドカードを利用できる
  また、一時的に無視したい場合には、
  $psdefaultparamatervalues[&quot;Disabled&quot;] = $tue
  とすれば良い。
#&gt;

# New-Item の ItemType をディレクトリにする
$PSDefaultParamaterValues = @{&quot;New-Item:ItemType&quot;=&quot;Directory&quot;}
</pre></div>
</div>
</div>
</div>
<div class="section" id="id11">
<h2>暗黙的な変数<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">以下にいくつか、便利な自動変数を列挙した。</div>
<div class="line">これ以外にも様々な自動変数がある。</div>
<div class="line">詳細は、 <code class="docutils literal"><span class="pre">about_Automatic_Variables</span></code> を参照のこと。</div>
</div>
<ul class="simple">
<li>$_ ($PSItem)<ul>
<li>現在のパイプラインオブジェクト</li>
</ul>
</li>
<li>$Input<ul>
<li>パイプラインに入力されたオブジェクト</li>
</ul>
</li>
<li>$Args<ul>
<li>関数に渡されるパラメータの配列</li>
</ul>
</li>
<li>$Switch, $foreach<ul>
<li>それぞれ、現在処理されているオブジェクト</li>
<li>current プロパティにアクセスすれば良い</li>
</ul>
</li>
<li>$Matches<ul>
<li>-match 演算子利用時に、マッチ情報が含まれた連想配列</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="net-framework">
<h2>.NET Framework の利用<a class="headerlink" href="#net-framework" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id12">
<h3>クラスのインスタンスを作成する<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">普段扱っているPowerShellのオブジェクトは、もともと .NET</div>
</div>
<p>Frameworkのものだが、
| もっと複雑なことをしたい場合に、直接クラスのインスタンスを作成することがある。</p>
<div class="code PowerShell highlight-python"><div class="highlight"><pre>$wc = New-Object System.Net.WebClient
$wc.DownloadString(&quot;http://www.atmarkit.co.jp/&quot;) &gt; atmarkit.html
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>静的メソッドの呼び出し<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal"><span class="pre">[クラス名]::func</span></code>でアクセスできる。</p>
<div class="code PowerShell highlight-python"><div class="highlight"><pre>[math]::Pow(2, 4)
</pre></div>
</div>
</div>
</div>
<div class="section" id="powershell">
<h2>PowerShell バージョンを指定する<a class="headerlink" href="#powershell" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>例えば、バージョン
3.0以降でのみ実行を許したい場合、スクリプト戦闘で、以下のように記載すれば良い。</p>
<div class="code PowerShell highlight-python"><div class="highlight"><pre>requires -Version 3.0
</pre></div>
</div>
</div>
</div>


 </div>
<div id="sidebar">
<div id="searchbox" style="display: none" role="search">
  <h3>クイック検索</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
</div>

      <div class="clearer"></div>
    </div>
<div id="related">
  <ul class="link">
    
      <li><a href="03_powershell_script_intro_tutorial.html">Prev</a></li>
    
    
      <li><a href="10_powershell_dsc.html">Next</a></li>
    
    <li><a href="../../genindex.html">Index</a></li>
  </ul>
</div>

<div id="footer">
  &copy;copyright:2015, hitsumabushi <br />
  Last update: Aug 31, 2015 <br />
  Created using Sphinx 1.3.1
</div>

  </body>
</html>